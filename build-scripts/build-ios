XCODE_PROJECT_DIR="../ios"
OUTPUT_DIR="../output" #Output directory relative to XCODE_PROJECT_DIR

#variables
EXPORT_OPTIONS_PLIST_PATH="exportOptions.plist"
OUTPUT_ARCHIVE_PATH="$OUTPUT_DIR/webport.xcarchive"
OUTPUT_IPA_PATH="$OUTPUT_DIR/webport.ipa"

cd $XCODE_PROJECT_DIR

if [ -f $OUTPUT_ARCHIVE_PATH ]; then
    rm $OUTPUT_ARCHIVE_PATH
fi

#Build
xcodebuild -project ./webport.xcodeproj -scheme "webport" -configuration Release clean archive -archivePath $OUTPUT_ARCHIVE_PATH

#Log into console weather the build was successful or not
if [ -d $OUTPUT_ARCHIVE_PATH ]; then
    echo "\nBuild SUCCESSFUL.\n"
else
    echo "\nBuild FAILED.\n"
    exit 1
fi

#Archive
xcodebuild -exportArchive -allowProvisioningUpdates -archivePath $OUTPUT_ARCHIVE_PATH -exportOptionsPlist $EXPORT_OPTIONS_PLIST_PATH -exportPath $OUTPUT_IPA_PATH

#Log into console weather the ipa was generated or not
if [ -f $OUTPUT_IPA_PATH ]; then
    echo "\nIpa generated SUCCESSFULLY.\n"
else
    echo "\nERROR: Failed to generate .ipa for archive: $OUTPUT_ARCHIVE_PATH\n"
    exit 2
fi